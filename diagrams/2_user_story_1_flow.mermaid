graph LR
    subgraph "Step 1: Define Workspace"
        YAML[ğŸ“„ workspace.yaml<br/>---<br/>name: customer-analytics<br/>env: dev<br/>description: Analytics workspace<br/>capacity_id: xxx<br/>template: standard<br/>git_integration: true âœ…<br/>naming_validation: true âœ…]
    end

    subgraph "Step 2: Execute Command"
        CMD[ğŸ’» Command Line<br/>python ops/scripts/onboard_data_product.py<br/>--yaml workspace.yaml<br/>--feature optional for feature branch]
        
        subgraph "Processing 9 seconds âš¡"
            VALIDATE[âœ… Validate YAML<br/>item_naming_validator.py]
            AUTH[ğŸ” Authenticate to Fabric<br/>Azure AD Service Principal]
            CREATE[ğŸ—ï¸ Create Workspace<br/>workspace_manager.py]
            GIT_LINK[ğŸ”— Link Git Repo âœ…<br/>fabric_git_connector.py<br/>Automated bidirectional sync]
            SCAFFOLD[ğŸ“ Scaffold Folders<br/>data_products/*/]
            REGISTER[ğŸ“ Register State<br/>.workspace_registry.json]
            LOG[ğŸ“Š Write Audit Log<br/>audit_logger.py â†’ JSONL]
        end
    end

    subgraph "Step 3: Results"
        subgraph "Fabric Cloud â˜ï¸"
            WORKSPACE[ğŸ¢ Workspace Created<br/>Customer Analytics DEV<br/>ID: be8d1df8-9067-...<br/>Capacity: FTL64 Trial âœ…<br/>Git: Linked âœ…]
            LAKEHOUSE[ğŸ—„ï¸ Lakehouse Item<br/>Optional resources<br/>Medallion folders âœ…]
        end

        subgraph "Git Repository ğŸ“š"
            GIT_BRANCH[ğŸŒ¿ Feature Branch âœ…<br/>feature/customer_analytics/<br/>Automated creation<br/>Bidirectional sync]
            FOLDERS[ğŸ“‚ Folder Structure<br/>data_products/<br/>  customer_analytics/<br/>    src/<br/>    tests/<br/>    config/<br/>    docs/<br/>    README.md]
        end

        subgraph "Audit & State ğŸ“‹"
            AUDIT[ğŸ“‹ Audit Log âœ…<br/>audit_trail.jsonl<br/>---<br/>event: workspace_created<br/>timestamp: 2025-10-27<br/>duration: 9s<br/>status: success<br/>git_linked: true<br/>validation: passed]
            
            REGISTRY_FILE[ğŸ“¦ Registry Entry<br/>.workspace_registry.json<br/>---<br/>workspace_id: be8d...<br/>name: customer-analytics<br/>created: 2025-10-27<br/>git_repo: linked<br/>naming_pattern: validated]
        end
    end

    subgraph "v2.0 Features âœ… PRODUCTION"
        V2_GIT[ğŸ”— Automated Git Integration<br/>No manual setup required]
        V2_NAMING[ğŸ“› Naming Validation<br/>Medallion architecture<br/>Sequential numbering]
        V2_AUDIT[ğŸ“ Enhanced Audit Trail<br/>JSONL format<br/>10+ event types]
    end

    YAML --> CMD
    CMD --> VALIDATE
    VALIDATE --> AUTH
    AUTH --> CREATE
    CREATE --> GIT_LINK
    GIT_LINK --> SCAFFOLD
    SCAFFOLD --> REGISTER
    REGISTER --> LOG

    CREATE --> WORKSPACE
    WORKSPACE --> LAKEHOUSE
    GIT_LINK --> GIT_BRANCH
    SCAFFOLD --> FOLDERS
    LOG --> AUDIT
    REGISTER --> REGISTRY_FILE

    V2_NAMING --> VALIDATE
    V2_GIT --> GIT_LINK
    V2_AUDIT --> LOG

    classDef inputStyle fill:#E3F2FD,stroke:#0078D4,stroke-width:3px
    classDef processStyle fill:#FFF3E0,stroke:#FF8C00,stroke-width:2px
    classDef outputStyle fill:#E8F5E9,stroke:#107C10,stroke-width:2px
    classDef cloudStyle fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px
    classDef v2Style fill:#0078D4,stroke:#005A9E,stroke-width:2px

    class YAML inputStyle
    class CMD,VALIDATE,AUTH,CREATE,GIT_LINK,SCAFFOLD,REGISTER,LOG processStyle
    class WORKSPACE,LAKEHOUSE cloudStyle
    class GIT_BRANCH,FOLDERS,AUDIT,REGISTRY_FILE outputStyle
    class V2_GIT,V2_NAMING,V2_AUDIT v2Style

    linkStyle default stroke:#0078D4,stroke-width:2px
