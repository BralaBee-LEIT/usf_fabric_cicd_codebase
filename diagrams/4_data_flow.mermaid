graph LR
    subgraph "Data Sources"
        SRC_RAW[ğŸ“Š Raw Data<br/>Excel, CSV, JSON, API]
        SRC_EXT[ğŸŒ External Systems<br/>3rd Party APIs]
        SRC_USER[ğŸ‘¤ User Input<br/>YAML Descriptors<br/>project.config.json âœ…<br/>Principals files âœ…]
    end

    subgraph "Ingestion Layer"
        INGEST_PARSE[ğŸ” YAML Parser<br/>Validate & Extract]
        INGEST_AUTH[ğŸ” Authentication<br/>Azure AD OAuth 2<br/>Token Management]
        INGEST_CONFIG[âš™ï¸ Configuration<br/>project.config.json âœ…<br/>Environment variables<br/>Defaults & overrides]
    end

    subgraph "Processing Layer - v2.0 âœ…"
        PROC_VALIDATE[âœ… Data Validation<br/>item_naming_validator.py âœ…<br/>Schema Checks<br/>Medallion architecture]
        PROC_TRANSFORM[ğŸ”„ Transformation<br/>Name Normalization<br/>Sequential numbering âœ…<br/>Ticket-based naming âœ…]
        PROC_ENRICH[â• Enrichment<br/>Add Metadata<br/>Audit context âœ…<br/>Git linkage info âœ…]
        PROC_LOGIC[ğŸ§  Business Logic<br/>Workspace Rules<br/>Capacity validation<br/>Principal assignments âœ…]
    end

    subgraph "API Integration Layer"
        API_FABRIC[â˜ï¸ Fabric REST API<br/>Workspace CRUD<br/>Item Management<br/>Git Integration âœ…]
        API_GIT[ğŸ“¦ Git API<br/>fabric git connector âœ…<br/>Repository Ops<br/>Automated linking]
        API_REGISTRY[ğŸ“ Registry API<br/>State Management<br/>.workspace_registry.json]
        API_AUDIT[ğŸ“‹ Audit API<br/>audit logger âœ…<br/>JSONL format<br/>10 plus event types]
    end

    subgraph "Storage Layer"
        STORE_CLOUD[ğŸ¢ Fabric Cloud<br/>Workspaces + Items<br/>Capacity assigned<br/>Git linked âœ…]
        STORE_LOCAL[ğŸ’¾ Local Filesystem<br/>Git Repository<br/>data products wildcard<br/>Scaffolded structure]
        STORE_AUDIT[ğŸ“‹ Audit Logs âœ…<br/>audit_trail.jsonl<br/>Immutable trail<br/>Compliance ready]
        STORE_REGISTRY[ğŸ—‚ï¸ Registry<br/>.workspace_registry.json<br/>Metadata catalog<br/>Version controlled]
    end

    subgraph "Output Layer"
        OUT_WORKSPACE[âœ… Created Workspace<br/>With Lakehouse<br/>Users configured âœ…<br/>Git synced âœ…]
        OUT_FOLDERS[ğŸ“ Scaffolded Files<br/>data products wildcard<br/>Template structure<br/>README.md]
        OUT_LOGS[ğŸ“Š Audit Trail âœ…<br/>JSONL Logs<br/>Complete history<br/>Event tracking]
        OUT_REGISTRY[ğŸ“¦ Registry Entry<br/>Workspace Metadata<br/>Naming validated âœ…<br/>Git repo linked âœ…]
        OUT_GIT[ğŸŒ¿ Git Branch âœ…<br/>Feature branch<br/>Bidirectional sync<br/>Automated creation]
    end

    subgraph "Monitoring & Feedback"
        MON_CONSOLE[ğŸ’» Console Output<br/>Rich Progress Display<br/>âš¡ 9-second execution]
        MON_LOGS[ğŸ“„ Log Files<br/>Debug Information]
        MON_METRICS[ğŸ“ˆ Metrics<br/>Duration, Success Rate<br/>Optional: App Insights]
    end

    SRC_USER --> INGEST_PARSE
    SRC_RAW -.->|Future| INGEST_PARSE
    SRC_EXT -.->|Future| API_FABRIC
    
    INGEST_PARSE --> PROC_VALIDATE
    INGEST_AUTH --> API_FABRIC
    INGEST_CONFIG --> PROC_LOGIC

    PROC_VALIDATE --> PROC_TRANSFORM
    PROC_TRANSFORM --> PROC_ENRICH
    PROC_ENRICH --> PROC_LOGIC

    PROC_LOGIC --> API_FABRIC
    PROC_LOGIC --> API_GIT
    PROC_LOGIC --> API_REGISTRY
    PROC_LOGIC --> API_AUDIT

    API_FABRIC --> STORE_CLOUD
    API_GIT --> STORE_LOCAL
    API_REGISTRY --> STORE_REGISTRY
    API_AUDIT --> STORE_AUDIT

    STORE_CLOUD --> OUT_WORKSPACE
    STORE_LOCAL --> OUT_FOLDERS
    STORE_AUDIT --> OUT_LOGS
    STORE_REGISTRY --> OUT_REGISTRY
    API_GIT --> OUT_GIT

    OUT_WORKSPACE --> MON_CONSOLE
    OUT_FOLDERS --> MON_CONSOLE
    OUT_GIT --> MON_CONSOLE
    OUT_LOGS --> MON_LOGS
    OUT_REGISTRY --> MON_METRICS

    MON_CONSOLE -.->|Feedback| SRC_USER
    MON_LOGS -.->|Debug Info| PROC_LOGIC
    MON_METRICS -.->|Performance| PROC_LOGIC

    classDef source fill:#E3F2FD,stroke:#0078D4,stroke-width:2px
    classDef process fill:#FFF3E0,stroke:#FF8C00,stroke-width:2px
    classDef v2process fill:#E8F5E9,stroke:#107C10,stroke-width:3px
    classDef storage fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px
    classDef output fill:#E8F5E9,stroke:#107C10,stroke-width:2px
    classDef monitor fill:#FFF9C4,stroke:#F57F17,stroke-width:2px

    class SRC_RAW,SRC_EXT,SRC_USER source
    class INGEST_PARSE,INGEST_AUTH,INGEST_CONFIG process
    class PROC_VALIDATE,PROC_TRANSFORM,PROC_ENRICH,PROC_LOGIC v2process
    class API_FABRIC,API_GIT,API_REGISTRY,API_AUDIT v2process
    class STORE_CLOUD,STORE_LOCAL,STORE_AUDIT,STORE_REGISTRY storage
    class OUT_WORKSPACE,OUT_FOLDERS,OUT_LOGS,OUT_REGISTRY,OUT_GIT output
    class MON_CONSOLE,MON_LOGS,MON_METRICS monitor

    linkStyle default stroke:#0078D4,stroke-width:2px
