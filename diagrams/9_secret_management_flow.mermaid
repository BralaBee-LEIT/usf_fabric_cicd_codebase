flowchart TD
    A[Application Requests Secret] --> B{Feature Flag<br/>USE_KEY_VAULT?}
    
    B -->|Enabled| C{Check Cache<br/>TTL=1hr}
    B -->|Disabled| D[Load from .env]
    
    C -->|Cache Hit| E[Return Cached Value]
    C -->|Cache Miss| F[Fetch from Key Vault<br/>with Retry]
    
    F -->|Success| G[Cache Result<br/>Return Value]
    F -->|Failure| H[Fallback to .env<br/>Graceful Degradation]
    
    D --> I[Return Secret]
    E --> I
    G --> I
    H --> I
    
    style A fill:#e1f5ff
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style F fill:#ff9800
    style G fill:#4caf50
    style H fill:#f44336
    style I fill:#00bcd4
